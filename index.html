<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AR Crimmus Cats</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">

<a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true;"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false;"
        cursor="rayOrigin: mouse">

    <!-- Green Cat Marker -->
    <a-nft
            type="nft"
            url="./markers/cat-green"
            smooth="true"
            smoothCount="10"
            smoothTolerance=".01"
            smoothThreshold="5"
            id="greenCat">

        <a-box
                position="0 0.5 0"
                rotation="0 45 0"
                material="color: #00ff00; opacity: 0.8;"
                animation="property: rotation; to: 0 405 0; loop: true; dur: 3000"
                scale="0.8 0.8 0.8"
                class="clickable"
                id="greenBox">
        </a-box>

        <a-text
                value="Click me!"
                position="0 1.5 0"
                align="center"
                color="#00ff00"
                scale="1.2 1.2 1.2">
        </a-text>
    </a-nft>

    <!-- Purple Cat Marker -->
    <a-nft
            type="nft"
            url="./markers/cat-purple"
            smooth="true"
            smoothCount="10"
            smoothTolerance=".01"
            smoothThreshold="5"
            id="purpleCat"
            visible="false">

        <a-sphere
                position="0 0.5 0"
                radius="0.5"
                material="color: #ff00ff; opacity: 0.8;"
                animation="property: position; to: 0 1.2 0; loop: true; dur: 2000; dir: alternate; easing: easeInOutQuad"
                class="clickable"
                id="purpleSphere">
        </a-sphere>

        <a-text
                value="Click me too!"
                position="0 2 0"
                align="center"
                color="#ff00ff"
                scale="1.2 1.2 1.2">
        </a-text>
    </a-nft>

    <a-entity camera></a-entity>
</a-scene>

<script>
    AFRAME.registerComponent('star-spawner', {
        init: function() {
            this.el.addEventListener('click', (evt) => {
                console.log('Clicked!');
                this.spawnStar(evt);
            });
        },

        spawnStar: function(evt) {
            const star = document.createElement('a-entity');

            // Позиция клика
            const clickPos = this.el.object3D.position;

            // Создаём звезду
            star.setAttribute('geometry', {
                primitive: 'tetrahedron',
                radius: 0.15
            });

            star.setAttribute('material', {
                color: '#ffff00',
                emissive: '#ffaa00',
                emissiveIntensity: 0.5
            });

            star.setAttribute('position', {
                x: clickPos.x + (Math.random() - 0.5) * 0.5,
                y: clickPos.y + 0.5,
                z: clickPos.z + (Math.random() - 0.5) * 0.5
            });

            // Анимация: вращение и исчезновение
            star.setAttribute('animation', {
                property: 'rotation',
                to: '0 360 360',
                loop: true,
                dur: 2000
            });

            star.setAttribute('animation__scale', {
                property: 'scale',
                from: '0 0 0',
                to: '1 1 1',
                dur: 500,
                easing: 'easeOutElastic'
            });

            star.setAttribute('animation__fadeout', {
                property: 'scale',
                to: '0 0 0',
                delay: 2000,
                dur: 500
            });

            // Добавляем к родителю
            this.el.parentEl.appendChild(star);

            // Удаляем через 3 секунды
            setTimeout(() => {
                if (star.parentNode) {
                    star.parentNode.removeChild(star);
                }
            }, 3000);
        }
    });

    // Логика маркеров
    let greenScanned = false;

    const greenMarker = document.querySelector('#greenCat');
    const purpleMarker = document.querySelector('#purpleCat');

    greenMarker.addEventListener('markerFound', () => {
        console.log('Green cat found!');
        greenScanned = true;
        purpleMarker.setAttribute('visible', 'true');
    });

    // Добавляем компонент к кликабельным объектам
    document.addEventListener('DOMContentLoaded', () => {
        const greenBox = document.querySelector('#greenBox');
        const purpleSphere = document.querySelector('#purpleSphere');

        if (greenBox) {
            greenBox.setAttribute('star-spawner', '');
        }

        if (purpleSphere) {
            purpleSphere.setAttribute('star-spawner', '');
        }
    });
</script>

</body>
</html>